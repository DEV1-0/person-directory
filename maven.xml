<project
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:util="jelly:util"
    xmlns:maven="jelly:maven"
    xmlns:license="license">


    <!-- ============== SITE ================== -->
	<!--
	 | Copies the site to the siteDir location, set by the cruiscontrol
	 | nightly build process.
	 +-->
    <postGoal name="site">
        <j:if test="${not empty siteDir}">
        <ant:copy todir="${siteDir}">
            <ant:fileset dir="target/docs/">
                <ant:include name="**" />
            </ant:fileset>
        </ant:copy>
        </j:if>
    </postGoal>
   
    <!-- ============== JAR ================== -->
	<!--
	 | The post goal currently creates a testframework jar along with the main JAR to
	 | allow for base unit tests to be re-used.
	 +-->
    <postGoal name="jar:jar">
        <j:set var="finalName" value="${pom.getPluginContext('maven-jar-plugin').getVariable('maven.final.name')}"/>
        <j:set var="finalVersion" value="${finalName.substring(17)}"/>
        <j:set var="testfwkBase" value="${pom.artifactId}-testframework"/>
        <j:set var="testfwkName" value="${testfwkBase}-${finalVersion}"/>

        <ant:jar jarfile="${maven.build.dir}/${testfwkName}.jar">
            <j:set var="licenseFileName">
                <license:fileName/>
            </j:set>
            <util:file name="${licenseFileName}" var="licenseFile"/>
    
            <ant:metainf dir="${licenseFile.canonicalFile.parent}">
                <ant:include name="${licenseFile.canonicalFile.name}"/>
            </ant:metainf>
    
            <ant:manifest>
                <ant:attribute name="Built-By" value="${user.name}"/>
                <ant:attribute name="Created-By" value="Apache Jakarta Maven"/>
                <ant:attribute name="Package" value="${pom.package}"/>
                <ant:attribute name="Build-Jdk" value="${java.version}"/>
                <!-- added supplementary entries -->
                <ant:attribute name="Extension-Name" value="Person Directory Test Framework"/>
                <ant:attribute name="Specification-Version" value="${pom.specificationVersion}"/>
                <ant:attribute name="Specification-Vendor" value="${pom.organization.name}"/>
                <ant:attribute name="Specification-Title" value="Person Directory Test Framework"/>
                <ant:attribute name="Implementation-Version" value="${pom.currentVersion}"/>
                <ant:attribute name="Implementation-Vendor" value="${pom.organization.name}"/>
                <ant:attribute name="Implementation-Vendor-Id" value="${pom.organization.identifier}"/>
            </ant:manifest>
    
            <ant:fileset dir="${maven.test.dest}">
                <ant:include name="**/Abstract*Test.class"/>
            </ant:fileset>
        </ant:jar>
    </postGoal>

</project>
